# Notes about SWUpdate

SWUpdate это фреймворк, в связи с этим поддержка новых возможностей легко реализуема.

Обновление с носителя выполняется в автоматическом режиме. В общем случае, такое обновление выполняется для вариантом с одной копией файловой системы. Однако возможно использование двух копий с применением [Software Collections](http://sbabic.github.io/swupdate/sw-description.html#collections).

При обновлении в удаленном режиме, SWUpdate запускает встроенный Web-сервер и ожидает команд. Оператор должен загрузить образ, который SWUpdate проверит и установит. Ход выполнения команд отображается в браузере оператора.

## Некоторые возможности SWUpdate

* SWUpdate задумывался для обновления UBI разделов. Однако образ может быть представлен как раздел на SD карте или MTD
* SWUpdate умеет создавать UBI разделы, изменять их размер и копировать новое ПО
* возможность обновление одного файла на файловой системе
* OTA / Remote
  * с помощью встроенного WEB сервера
  * скачивание с удаленного сервера (HTTP, HTTPS)
  * использование сторонних серверов, на данный момент поддерживается сервер Hawkbit, другие можно добавлять
* возможна проверка совместимости аппаратуры и обновления
* возможность установки FPGA программ используя дополнительные протоколы
* проверка подлинности образа перед установкой
* безопасность при выключении питания

## Файлы обновления одним образом

Образ для обновления представлен одним большим файлом. Это cpio файл, который несёт в себе обновления для всех частей системы. В заголовке cpio указаны составные части обновления. Для каждой из передаваемых частей SWUpdate использует свой обработчик.

К примеру,  центральный процессор должен обновить микроконтроллер, используя специальный протокол. Для этого можно определить специальный обработчик, ответственный за данное обновление.

## Потоковое обновление

SWUpdate задумывался для возможности потокового обновления, без создания промежуточных копий. Это необходимо в условиях, если на целевой системе недостаточно ресурсов для создания промежуточной копии. Однако в этом случае не возможна проверка целостности образа.

## Зависимости

Для работы SWUpdate необходиммы следующие библиотеки

* mtd-utils: для внутреннего использования библиотеки libmtd and libubi, необходимы для работы с MTD и UBI разделами
* openssl, необходима для Webserver
* liblua и заголовочные файлы
* libz, libcrypto
* libconfig, используется парсером по умолчанию
* libarchive (опционально) для работы с архивами
* librsync (опционально) для работы с rdiff патчами
* libjson (опционально) для парсера JSON и Hawkbit
* libubootenv (опицонально) поддержка U-Boot
* libebgenv (опционально) поддержка EFI Boot Guard
* libcurl для работы с сетью

Два режима работы, один - в режиме сервера (Mongoose mode), когда необходимо подключиться к целевой системе для того, чтобы выполнить обновление. Второй режим - в режиме клиента (Suricatta mode), когда целевая система периодически опрашивает заданный сервер на наличие обновлений.

В режиме клиента в настоящий момент поддерживается сервер hawkBit.

## Links

* [Building a Linux system for the STM32MP1: remote firmware updates](https://bootlin.com/blog/tag/swupdate/)
